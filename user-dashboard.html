<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>VGM | User Dashboard</title>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    :root{
      --bg:#050a18;
      --stroke:rgba(255,255,255,.12);
      --text:#eaf0ff;
      --muted:rgba(234,240,255,.65);
      --ok:#22c55e;
      --err:#f87171;
      --blue:#5b6cff;
      --purple:#7c4dff;
      --green:#34d399;
      --cyan:#38bdf8;
      --pink:#ff4da6;
      --shadow: 0 26px 90px rgba(0,0,0,.55);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      color:var(--text);
      padding:16px;
      padding-bottom:140px;
      overflow-x:hidden;
      background: var(--bg);
    }

    /* ===== UPPER ECHELON BACKGROUND ===== */
    .bgFlow{
      position:fixed; inset:0; z-index:-4;
      background:
        radial-gradient(900px 520px at 10% 10%, rgba(83,113,255,.30), transparent 55%),
        radial-gradient(900px 520px at 90% 20%, rgba(52,211,153,.20), transparent 55%),
        radial-gradient(900px 520px at 40% 92%, rgba(255,77,166,.16), transparent 60%),
        linear-gradient(180deg, rgba(5,10,24,1), rgba(2,6,23,1));
    }
    .blob{
      position:fixed;
      width:520px;height:520px;border-radius:999px;
      filter: blur(72px);
      opacity:.60;
      z-index:-3;
      mix-blend-mode: screen;
      will-change: transform;
    }
    .blob.b1{ background: rgba(91,108,255,.92); left:-150px; top:-160px; animation: drift1 10s ease-in-out infinite; }
    .blob.b2{ background: rgba(124,77,255,.82); right:-220px; top:5%; animation: drift2 12s ease-in-out infinite; }
    .blob.b3{ background: rgba(52,211,153,.55); left:10%; bottom:-250px; animation: drift3 14s ease-in-out infinite; }
    .blob.b4{ background: rgba(255,77,166,.58); right:10%; bottom:-260px; animation: drift4 11s ease-in-out infinite; }

    @keyframes drift1{0%{transform:translate(0,0) scale(1)}50%{transform:translate(250px,140px) scale(1.10)}100%{transform:translate(0,0) scale(1)}}
    @keyframes drift2{0%{transform:translate(0,0) scale(1)}50%{transform:translate(-280px,170px) scale(1.14)}100%{transform:translate(0,0) scale(1)}}
    @keyframes drift3{0%{transform:translate(0,0) scale(1)}50%{transform:translate(210px,-210px) scale(1.10)}100%{transform:translate(0,0) scale(1)}}
    @keyframes drift4{0%{transform:translate(0,0) scale(1)}50%{transform:translate(-180px,-130px) scale(1.09)}100%{transform:translate(0,0) scale(1)}}

    .shimmer{
      position:fixed; inset:-30px; z-index:-2;
      opacity:.28;
      background:
        radial-gradient(600px 280px at 30% 10%, rgba(255,255,255,.10), transparent 60%),
        radial-gradient(700px 320px at 80% 60%, rgba(255,255,255,.07), transparent 60%),
        linear-gradient(120deg, transparent, rgba(255,255,255,.05), transparent);
      animation: shimmerMove 6s ease-in-out infinite alternate;
      pointer-events:none;
    }
    @keyframes shimmerMove{
      from{transform:translateY(0px) translateX(0px)}
      to{transform:translateY(42px) translateX(22px)}
    }

    .container{max-width:920px;margin:0 auto}

    /* ‚úÖ DESKTOP WIDE VIEW */
    @media (min-width: 1100px){
      .container{max-width:1250px;}
    }
    @media (min-width: 1500px){
      .container{max-width:1380px;}
    }

    /* ===== Loading Gate ===== */
    #authGate{
      position:fixed; inset:0; z-index:99999;
      display:flex; align-items:center; justify-content:center;
      background:
        radial-gradient(900px 420px at 10% 0%, rgba(83,113,255,.22), transparent 55%),
        radial-gradient(900px 420px at 90% 0%, rgba(52,211,153,.18), transparent 55%),
        var(--bg);
    }
    .gateCard{
      width:min(520px,92vw);
      border:1px solid rgba(255,255,255,.14);
      background:rgba(0,0,0,.25);
      border-radius:22px;
      padding:18px;
      box-shadow:0 26px 90px rgba(0,0,0,.55);
      backdrop-filter: blur(14px);
      text-align:center;
    }

    /* ‚úÖ LOGO IMAGE STYLE */
    .logoImg{
      width:100%;
      height:100%;
      object-fit:contain;
      display:block;
    }

    .gateLogo{
      width:62px;height:62px;border-radius:18px;
      margin:0 auto 10px;
      display:grid;place-items:center;
      border:1px solid rgba(255,255,255,.14);
      background:linear-gradient(180deg, rgba(109,87,255,1), rgba(124,77,255,1));
      box-shadow:0 18px 50px rgba(109,87,255,.28);
      overflow:hidden;
    }
    .gateTxt{font-weight:1000}
    .gateSub{margin-top:6px;color:rgba(234,240,255,.70);font-weight:900;font-size:13px}
    .spinner{
      width:46px;height:46px;margin:14px auto 0;
      border-radius:999px;
      border:3px solid rgba(255,255,255,.18);
      border-top-color:#9bdcff;
      animation:spin 1s linear infinite;
    }
    @keyframes spin{to{transform:rotate(360deg)}}

    /* ============================================================
      ‚úÖ STICKY MENU POLISH
    ============================================================ */
    .stickyMenu{
      position:sticky;
      top:12px;
      z-index:3000;
      margin-bottom:10px;
    }
    .stickyMenu::before{
      content:"";
      position:absolute;
      inset:-10px -10px -8px -10px;
      border-radius:26px;
      background:rgba(5,10,24,.58);
      border:1px solid rgba(255,255,255,.12);
      box-shadow:0 18px 70px rgba(0,0,0,.55);
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
      z-index:-1;
      pointer-events:none;
      opacity:0;
      transform: translateY(-6px);
      transition: .18s ease;
    }
    .stickyMenu.isStuck::before{
      opacity:1;
      transform: translateY(0);
    }
    .stickyMenu.isStuck .topRow{
      margin-bottom:8px;
    }

    /* ===== TOP BAR ===== */
    .topRow{
      display:flex; align-items:center; justify-content:space-between;
      gap:12px; margin-bottom:14px;
    }

    /* ‚úÖ brand shifted left */
    .brand{
      display:flex;
      align-items:center;
      gap:0;
      padding:0;
      border:none;
      background:transparent;
      box-shadow:none;
      min-width:unset;

      /* ‚úÖ SHIFT LEFT */
      margin-left:-14px;
    }

    /* ‚úÖ LOGO MAGNIFIED CORRECTLY (NO TRANSFORM) */
    .brandLogoWide{
      height:88px;              /* ‚úÖ bigger logo */
      width:auto;
      max-width:520px;
      display:block;
      object-fit:contain;

      /* ‚úÖ lift it so bar doesn't expand */
      margin-top:-18px;
      margin-bottom:-18px;

      filter:
        drop-shadow(0 18px 35px rgba(0,0,0,.55))
        drop-shadow(0 0 22px rgba(91,108,255,.22));
    }

    @media(max-width:520px){
      .brand{
        margin-left:-10px;
      }
      .brandLogoWide{
        height:76px;
        margin-top:-14px;
        margin-bottom:-14px;
        max-width:340px;
      }
    }

    .headerActions{display:flex;gap:10px;align-items:center}

    .avatarBtn{
      width:46px;height:46px;border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background:linear-gradient(180deg, rgba(124,77,255,1), rgba(109,87,255,1));
      cursor:pointer;
      box-shadow:0 16px 40px rgba(124,77,255,.32);
      display:grid;place-items:center;
      position:relative;overflow:hidden;
    }
    .avatarBtn:hover{filter:brightness(1.05)}
    .avatarFallback{font-size:18px;line-height:1;z-index:2;}
    .avatarImgBtn{position:absolute; inset:0;width:100%; height:100%;object-fit:cover;display:none;z-index:3;}

    .iconBtn{
      width:46px;height:46px;border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(0,0,0,.18);
      color:white;font-weight:1000;
      cursor:pointer;
      box-shadow:0 16px 40px rgba(0,0,0,.35);
      backdrop-filter: blur(10px);
    }
    .iconBtn:hover{background:rgba(255,255,255,.08)}

    /* ‚úÖ Hide topRow + dock when menu open */
    body.menuOpen #stickyMenu{
      visibility:hidden;
      pointer-events:none;
    }
    body.menuOpen .dock{
      display:none;
    }

    /* ===== HELLO CARD ===== */
    .helloCard{
      border-radius:20px;
      padding:16px 16px;
      overflow:hidden;
      background:
        radial-gradient(800px 220px at 20% 20%, rgba(255,255,255,.18), transparent 60%),
        linear-gradient(90deg, rgba(109,87,255,1), rgba(255,77,166,0.98));
      color:white;
      box-shadow:0 22px 70px rgba(109,87,255,.22);
      display:flex;align-items:center;justify-content:space-between;gap:12px;
    }
    .helloLeft{display:flex;align-items:center;gap:12px;}

    .helloLogo{
      width:48px;height:48px;border-radius:18px;
      background:rgba(255,255,255,.20);
      border:1px solid rgba(255,255,255,.22);
      display:grid;place-items:center;
      font-weight:1000;
      font-size:22px;
    }

    .chips{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:6px}
    .miniChip{
      font-size:12px;font-weight:1000;
      padding:6px 10px;border-radius:999px;
      background:rgba(255,255,255,.18);
      border:1px solid rgba(255,255,255,.22);
      display:flex;gap:6px;align-items:center;
    }
    .helloTitle{font-weight:1000;font-size:18px}
    .helloSub{font-size:12px;font-weight:900;opacity:.92}

    .helloRight{
      display:flex;flex-direction:column;align-items:flex-end;gap:8px;
    }
    .helloRightTop{display:flex;align-items:center;gap:10px}
    .idChip{
      padding:8px 12px;border-radius:999px;
      background:rgba(255,255,255,.18);
      border:1px solid rgba(255,255,255,.22);
      font-weight:1000;font-size:12px;
    }
    .logoutBtn{
      width:46px;height:46px;border-radius:999px;border:none;
      cursor:pointer;
      background:rgba(239,68,68,0.95);
      color:#fff;
      font-weight:1000;
      box-shadow:0 16px 40px rgba(239,68,68,.22);
    }
    .datetimeChip{
      padding:6px 10px;border-radius:999px;
      background:rgba(255,255,255,.16);
      border:1px solid rgba(255,255,255,.20);
      font-weight:1000;font-size:12px;
      color:#fff;
      white-space:nowrap;
    }

    /* ===== BOX ===== */
    .box{
      border:1px solid rgba(255,255,255,.12);
      border-radius:24px;
      padding:16px;
      background:
        radial-gradient(700px 220px at 12% 10%, rgba(56,189,248,.14), transparent 62%),
        radial-gradient(700px 220px at 88% 18%, rgba(255,77,166,.10), transparent 62%),
        linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
      box-shadow:0 26px 90px rgba(0,0,0,.55);
      backdrop-filter: blur(12px);
      margin-top:14px;
    }
    .box h2{margin:0;font-size:20px;font-weight:1000}
    .small{color:var(--muted);font-size:13px;margin-top:8px}
    .ok{color:var(--ok);font-weight:1000}
    .err{color:var(--err);font-weight:1000}
    .card{
      border:1px solid rgba(255,255,255,.12);
      border-radius:18px;
      padding:12px;
      background:rgba(0,0,0,.22);
      box-shadow:0 16px 40px rgba(0,0,0,.35);
    }

    .box, .balanceCard, .cryptoRow, .action, .card, .chartWrap, .obRow{
      -webkit-tap-highlight-color: transparent;
    }

    /* ===== balanceCard ===== */
    .balanceCard{
      margin-top:14px;
      border-radius:24px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.10);
      background:
        radial-gradient(900px 400px at 15% 20%, rgba(0,0,0,0.55), transparent 55%),
        radial-gradient(900px 400px at 70% 20%, rgba(52,211,153,.24), transparent 55%),
        linear-gradient(135deg, rgba(3,7,18,0.92), rgba(15,23,42,0.84));
      color:white;
      box-shadow: 0 26px 60px rgba(0,0,0,0.25);
      padding:16px;
    }
    .bTitle{font-size:13px;font-weight:1000;opacity:.85}
    .bValue{font-size:34px;font-weight:1000;margin-top:8px}
    .bHint{margin-top:6px;font-size:13px;font-weight:900;opacity:.88;display:flex;gap:10px;align-items:center}
    .dot{width:10px;height:10px;border-radius:999px;background:var(--green)}
    .actionGrid{
      margin-top:16px;
      display:grid;
      grid-template-columns:repeat(4,1fr);
      gap:12px;
    }
    .action{
      border-radius:18px;
      background:rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.12);
      padding:12px;
      display:flex;flex-direction:column;
      align-items:center;justify-content:center;
      gap:8px;
      cursor:pointer;
      transition:.18s ease;
    }
    .action:hover{transform: translateY(-2px);background:rgba(255,255,255,.10)}
    .aIcon{
      width:48px;height:48px;border-radius:999px;
      display:grid;place-items:center;
      font-size:20px;
      font-weight:1000;color:#fff;
    }
    .aSend{background:linear-gradient(180deg,#6d57ff,#7c4dff)}
    .aReceive{background:linear-gradient(180deg,#18c07b,#11b981)}
    .aPlans{background:linear-gradient(180deg,#f59e0b,#f97316)}
    .aSupport{background:linear-gradient(180deg,#38bdf8,#5b6cff)}
    .aText{font-weight:1000;font-size:13px}

    /* ===== converters ===== */
    .convGrid{margin-top:14px;display:grid;gap:12px}
    .convRow{display:flex;gap:10px;flex-wrap:wrap}
    .inp{
      flex:1;min-width:140px;
      height:50px;border-radius:16px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(0,0,0,.22);
      color:var(--text);
      padding:10px 12px;
      font-weight:1000;
      outline:none;
      box-shadow:0 16px 40px rgba(0,0,0,.35);
    }
    .swapBtn{
      width:54px;height:50px;border-radius:16px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.08);
      color:#fff;
      font-weight:1000;
      cursor:pointer;
      box-shadow:0 16px 40px rgba(0,0,0,.35);
    }
    .swapBtn:hover{filter:brightness(1.05)}
    .convBtn{
      width:100%;
      height:54px;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.12);
      background:linear-gradient(180deg, rgba(91,108,255,1), rgba(124,77,255,1));
      color:white;
      font-weight:1000;
      cursor:pointer;
      box-shadow:0 18px 55px rgba(91,108,255,.18);
      display:flex;align-items:center;justify-content:center;gap:10px;
    }
    .convBtn:hover{filter:brightness(1.05)}
    .rateLine{
      margin-top:10px;
      font-size:12px;
      color:rgba(234,240,255,.75);
      font-weight:900;
      display:flex;
      gap:8px;
      align-items:center;
      flex-wrap:wrap;
    }
    .rateDot{
      width:10px;height:10px;border-radius:999px;
      background:rgba(52,211,153,1);
      box-shadow:0 0 18px rgba(52,211,153,.55);
    }

    /* ===== searchable dropdown unlimited ===== */
    .ddWrap{flex:1;min-width:220px;position:relative}
    .ddBtn{
      width:100%;
      height:50px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(0,0,0,.22);
      color:rgba(234,240,255,.95);
      padding:10px 12px;
      font-weight:1000;
      outline:none;
      box-shadow:0 16px 40px rgba(0,0,0,.35);
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .ddLeft{display:flex;align-items:center;gap:10px;min-width:0}
    .ddIcon{
      width:34px;height:34px;border-radius:12px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.06);
      display:grid;place-items:center;
      font-size:14px;
      overflow:hidden;
    }
    .ddName{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
    .ddPanel{
      position:absolute; top:56px; left:0; right:0;
      z-index:100;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(2,6,23,.94);
      box-shadow:0 26px 90px rgba(0,0,0,.65);
      backdrop-filter: blur(16px);
      overflow:hidden;
      display:none;
    }
    .ddPanel.show{display:block;}
    .ddSearch{
      width:100%;
      height:46px;
      border:none; outline:none;
      padding:0 12px;
      font-weight:1000;
      color:#fff;
      background:rgba(0,0,0,.20);
      border-bottom:1px solid rgba(255,255,255,.10);
    }
    .ddList{max-height:320px;overflow:auto;}
    .ddItem{
      padding:12px 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      cursor:pointer;
      border-bottom:1px solid rgba(255,255,255,.06);
      color:rgba(234,240,255,.86);
      font-weight:900;
    }
    .ddItem:hover{background:rgba(255,255,255,.06)}
    .ddItem small{color:rgba(234,240,255,.55);font-weight:900}

    /* ===== mini chart ===== */
    .chartWrap{
      margin-top:12px;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.12);
      overflow:hidden;
      background:rgba(0,0,0,.22);
      box-shadow:0 16px 40px rgba(0,0,0,.35);
    }
    .chartHead{
      display:flex;justify-content:space-between;align-items:center;
      padding:10px 12px;
      border-bottom:1px solid rgba(255,255,255,.10);
      font-weight:1000;
      color:rgba(234,240,255,.78);
      font-size:13px;
    }
    .chartFrame{width:100%;height:340px;border:0;display:block}

    /* ===== ORDER BOOK (NEW) ===== */
    .orderBookWrap{
      margin-top:12px;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.12);
      overflow:hidden;
      background:rgba(0,0,0,.22);
      box-shadow:0 16px 40px rgba(0,0,0,.35);
    }
    .obHead{
      display:flex;justify-content:space-between;align-items:center;
      padding:10px 12px;
      border-bottom:1px solid rgba(255,255,255,.10);
      font-weight:1000;
      color:rgba(234,240,255,.78);
      font-size:13px;
    }
    .obStatus{
      display:flex;gap:8px;align-items:center;font-weight:1000;font-size:12px;color:rgba(234,240,255,.70);
    }
    .pulseDot{
      width:9px;height:9px;border-radius:999px;background:rgba(34,197,94,1);
      box-shadow:0 0 18px rgba(34,197,94,.55);
      animation:pulse 1.3s ease-in-out infinite;
    }
    @keyframes pulse{
      0%{transform:scale(.85);opacity:.7}
      50%{transform:scale(1.1);opacity:1}
      100%{transform:scale(.85);opacity:.7}
    }
    .obGrid{
      display:grid;
      grid-template-columns: 1fr 90px 1fr;
      gap:10px;
      padding:12px;
    }
    @media (max-width:720px){
      .obGrid{ grid-template-columns:1fr; }
    }
    .obCol{
      border:1px solid rgba(255,255,255,.10);
      border-radius:16px;
      overflow:hidden;
      background:rgba(0,0,0,.18);
    }
    .obColHead{
      display:flex;justify-content:space-between;gap:10px;
      padding:10px 10px;
      font-weight:1000;font-size:12px;
      border-bottom:1px solid rgba(255,255,255,.08);
      color:rgba(234,240,255,.75);
    }
    .obRows{
      max-height:320px;
      overflow:auto;
    }
    .obRow{
      position:relative;
      display:grid;
      grid-template-columns: 1.15fr 1fr 1fr;
      gap:10px;
      padding:8px 10px;
      font-weight:1000;
      font-size:12px;
      border-bottom:1px solid rgba(255,255,255,.06);
    }
    .obRow:last-child{border-bottom:none}
    .obRow span{z-index:2;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .obRow .p{color:#f87171}
    .obRow.ask .p{color:#f87171}
    .obRow.bid .p{color:#22c55e}
    .obRow .bgBar{
      position:absolute; inset:0;
      z-index:1;
      opacity:.14;
    }
    .obRow.ask .bgBar{ background:linear-gradient(90deg, rgba(248,113,113,.0), rgba(248,113,113,.55)); transform-origin:right; }
    .obRow.bid .bgBar{ background:linear-gradient(90deg, rgba(34,197,94,.55), rgba(34,197,94,.0)); transform-origin:left; }
    .obMid{
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:8px;
      padding:10px 0;
    }
    .midPrice{
      font-weight:1000;
      font-size:15px;
    }
    .spreadPill{
      font-size:11px;
      font-weight:1000;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.08);
      color:rgba(234,240,255,.80);
    }
    .obFoot{
      padding:10px 12px;
      border-top:1px solid rgba(255,255,255,.10);
      display:flex;justify-content:space-between;gap:10px;
      color:rgba(234,240,255,.65);
      font-size:12px;font-weight:900;
    }

    /* ===== SIDEBAR ===== */
    .overlay{
      position:fixed; inset:0;
      background:rgba(0,0,0,.65);
      display:none; z-index:999;
      backdrop-filter: blur(4px);
    }
    .overlay.show{display:block;}
    .sidebar{
      position:fixed; top:0; left:-315px;
      width:292px; height:100vh;
      padding:16px;
      z-index:1000;
      transition: .28s ease;
      border-right:1px solid rgba(255,255,255,.10);
      background:
        radial-gradient(900px 420px at 15% 10%, rgba(91,108,255,.18), transparent 55%),
        radial-gradient(900px 420px at 90% 20%, rgba(52,211,153,.12), transparent 55%),
        linear-gradient(180deg, rgba(4,8,20,0.98), rgba(2,6,23,0.98));
      box-shadow:0 26px 90px rgba(0,0,0,.60);
      backdrop-filter: blur(16px);
      overflow-y:auto;
      -webkit-overflow-scrolling:touch;
      scrollbar-width: thin;
      scrollbar-color: rgba(255,255,255,.18) rgba(0,0,0,0);
    }
    .sidebar::-webkit-scrollbar{width:8px}
    .sidebar::-webkit-scrollbar-track{background:transparent}
    .sidebar::-webkit-scrollbar-thumb{
      background:rgba(255,255,255,.16);
      border-radius:999px;
      border:2px solid rgba(0,0,0,0);
      background-clip:padding-box;
    }
    .sidebar::-webkit-scrollbar-thumb:hover{background:rgba(255,255,255,.22)}
    .sidebar.open{ left:0; }

    .sideTop{
      display:flex;align-items:center;justify-content:space-between;
      gap:10px;margin-bottom:12px;
    }

    /* ‚úÖ sidebar logo same size as top */
    .sideBrand{
      display:flex;
      align-items:center;
      gap:0;
      padding:0;
      border:none;
      background:transparent;
      box-shadow:none;
      min-width:unset;
    }

    .sideLogoWide{
      height:88px;             /* ‚úÖ SAME AS TOP */
      width:auto;
      max-width:520px;
      display:block;
      object-fit:contain;
      margin-top:-18px;
      margin-bottom:-18px;
      filter:
        drop-shadow(0 18px 35px rgba(0,0,0,.55))
        drop-shadow(0 0 22px rgba(91,108,255,.18));
    }

    @media(max-width:520px){
      .sideLogoWide{
        height:76px;
        margin-top:-14px;
        margin-bottom:-14px;
        max-width:340px;
      }
    }

    .closeBtn{
      background:rgba(0,0,0,.22);
      border:1px solid rgba(255,255,255,.14);
      color:rgba(234,240,255,.95);
      border-radius:14px;
      width:44px;height:44px;
      cursor:pointer;
      display:grid;place-items:center;
      font-weight:1000;
    }
    .closeBtn:hover{background:rgba(255,255,255,.08)}

    .userTag{
      padding:12px 12px;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.10);
      background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
      box-shadow:0 18px 55px rgba(0,0,0,.35);
      margin:14px 0 14px;
      display:flex;align-items:center;justify-content:space-between;gap:12px;
    }
    .userTagLeft{min-width:0}
    .userTag .t1{color:rgba(234,240,255,.55);font-weight:1000;font-size:12px}
    .userTag .t2{
      margin-top:6px;font-weight:1000;
      white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
      max-width:180px;
    }

    .sideAvatar{
      width:46px;height:46px;border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(0,0,0,.25);
      display:grid;place-items:center;
      position:relative;overflow:hidden;
      box-shadow:0 16px 40px rgba(0,0,0,.35);
      flex:0 0 auto;
    }
    .sideAvatar span{font-size:18px}
    .sideAvatar img{
      position:absolute; inset:0;
      width:100%;height:100%;
      object-fit:cover;
      display:none;
    }

    .menuGroupTitle{
      margin:10px 0 8px;
      font-size:12px;font-weight:1000;
      color:rgba(234,240,255,.50);
      letter-spacing:.8px;
      text-transform:uppercase;
    }
    .sideItem{
      display:flex;align-items:center;gap:12px;
      padding:12px 12px;border-radius:18px;
      color:rgba(234,240,255,.82);
      text-decoration:none;
      font-weight:1000;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(0,0,0,.22);
      box-shadow:0 16px 40px rgba(0,0,0,.35);
      margin-bottom:10px;
      position:relative;overflow:hidden;
    }
    .sideItem:hover{background:rgba(255,255,255,.08)}
    .sideItem .i{
      width:42px;height:42px;border-radius:16px;
      display:grid;place-items:center;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.06);
      font-size:18px;
    }
    .sideItem small{display:block;color:rgba(234,240,255,.55);font-size:12px;font-weight:900;margin-top:2px}
    .activeLink{
      border:1px solid rgba(56,189,248,.55);
      background:linear-gradient(180deg, rgba(56,189,248,0.14), rgba(56,189,248,0.08));
      color:#cfefff;
    }
    .activeLink::after{
      content:"";
      position:absolute; inset:0;
      background: radial-gradient(600px 160px at 30% 20%, rgba(56,189,248,.20), transparent 60%);
      pointer-events:none;
    }
    .sideLogout{
      margin-top:10px;
      background:linear-gradient(90deg, rgba(248,113,113,1), rgba(239,68,68,1));
      color:#020617;border:none;width:100%;
      padding:14px;border-radius:18px;font-weight:1000;cursor:pointer;
      box-shadow:0 18px 55px rgba(239,68,68,.18);
    }
    .sideLogout:hover{filter:brightness(1.03)}

    /* ===== DOCK ===== */
    .dock{
      position:fixed;
      left:0; right:0; bottom:14px;
      z-index:2000;
      pointer-events:none;
    }
    .dockInner{
      pointer-events:auto;
      max-width:980px;
      margin:0 auto;
      padding:0 14px;
    }
    .dockBar{
      height:76px;
      border-radius:28px;
      background:rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.14);
      box-shadow:0 20px 70px rgba(0,0,0,.45);
      backdrop-filter: blur(14px);
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:10px 12px;
      gap:10px;
    }
    .dockItem{
      flex:1;
      min-width:70px;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:6px;
      border-radius:18px;
      padding:10px 0;
      color:rgba(234,240,255,.55);
      font-size:12px;
      font-weight:1000;
      cursor:pointer;
      user-select:none;
      position:relative;
    }
    .dockItem .ico{font-size:18px;opacity:.95}
    .dockItem:hover{background:rgba(255,255,255,.06)}
    .dockActive{color:#9bdcff;background:rgba(56,189,248,.10)}

    /* ‚úÖ home button stays HOME icon */
    .dockHome{
      width:78px;height:78px;border-radius:26px;
      background:linear-gradient(180deg, rgba(109,87,255,1), rgba(91,108,255,1));
      box-shadow:0 22px 55px rgba(109,87,255,.30);
      display:grid;place-items:center;
      margin-top:-32px;
      border:1px solid rgba(255,255,255,.16);
      cursor:pointer;user-select:none;
      flex:0 0 auto;
      pointer-events:auto;
      overflow:hidden;
      color:#fff;
      font-size:28px;
      font-weight:1000;
    }
    .dockHome:hover{filter:brightness(1.05)}

    .dockBadge{
      position:absolute;
      top:2px;
      right:18px;
      min-width:18px;
      height:18px;
      padding:0 6px;
      border-radius:999px;
      background:#f87171;
      color:#020617;
      font-weight:1000;
      font-size:11px;
      display:none;
      align-items:center;
      justify-content:center;
      border:1px solid rgba(255,255,255,.18);
    }

    /* ===== TOP 10 CRYPTO LIST ===== */
    .crypto10Grid{
      margin-top:12px;
      display:grid;
      gap:10px;
    }
    .cryptoRow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding:12px;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(0,0,0,.22);
      box-shadow:0 16px 40px rgba(0,0,0,.35);
    }
    .cryptoLeft{
      display:flex;
      align-items:center;
      gap:12px;
      min-width:0;
    }
    .cryptoLogo{
      width:42px;
      height:42px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.06);
      display:grid;
      place-items:center;
      overflow:hidden;
      flex:0 0 auto;
    }
    .cryptoLogo img{width:100%;height:100%;object-fit:cover;display:block;}
    .cryptoName{
      font-weight:1000;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .cryptoSym{
      display:block;
      font-size:12px;
      font-weight:1000;
      color:rgba(234,240,255,.55);
      margin-top:2px;
    }
    .cryptoRight{
      text-align:right;
      flex:0 0 auto;
    }
    .cryptoPrice{
      font-weight:1000;
      font-size:14px;
    }
    .cryptoChg{
      margin-top:4px;
      font-weight:1000;
      font-size:12px;
      color:rgba(234,240,255,.65);
    }
    .cryptoChg.up{color:rgba(34,197,94,1)}
    .cryptoChg.down{color:rgba(248,113,113,1)}

    /* ===== NEWS ===== */
    .newsGrid{margin-top:12px;display:grid;gap:10px}
    .newsItem{
      display:flex;
      flex-direction:column;
      gap:8px;
      padding:12px;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(0,0,0,.22);
      box-shadow:0 16px 40px rgba(0,0,0,.35);
      text-decoration:none;
      color:rgba(234,240,255,.92);
    }
    .newsItem:hover{background:rgba(255,255,255,.06)}
    .newsTop{display:flex;justify-content:space-between;gap:10px;align-items:flex-start}
    .newsTitle{font-weight:1000;font-size:14px;line-height:1.25}
    .newsMeta{
      font-weight:900;
      font-size:12px;
      color:rgba(234,240,255,.55);
      display:flex;
      gap:8px;
      align-items:center;
      flex-wrap:wrap
    }
    .newsTag{
      padding:4px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.08);
      font-weight:1000;
      font-size:11px;
      color:rgba(234,240,255,.80)
    }
    .newsBottom{font-weight:900;font-size:12px;color:rgba(234,240,255,.65)}
  </style>
</head>

<body>
  <div class="bgFlow"></div>
  <div class="blob b1"></div>
  <div class="blob b2"></div>
  <div class="blob b3"></div>
  <div class="blob b4"></div>
  <div class="shimmer"></div>

  <!-- Loading -->
  <div id="authGate">
    <div class="gateCard">
      <div class="gateLogo">
        <img class="logoImg" src="assets/vgm-logo.png" alt="Veloci Global Markets Logo">
      </div>
      <div class="gateTxt">Veloci Global Markets</div>
      <div class="gateSub">Precision trading. Real-time execution.</div>
      <div class="spinner"></div>
    </div>
  </div>

  <div id="overlay" class="overlay" onclick="closeMenu()"></div>

  <!-- Sidebar -->
  <div id="sidebar" class="sidebar">
    <div class="sideTop">
      <div class="sideBrand">
        <img class="sideLogoWide" src="assets/vgm-logo.png" alt="VGM Logo">
      </div>
      <button class="closeBtn" onclick="closeMenu()">‚úï</button>
    </div>

    <div class="userTag">
      <div class="userTagLeft">
        <div class="t1">Logged in as</div>
        <div id="sideName" class="t2">---</div>
      </div>
      <div class="sideAvatar" title="Profile photo">
        <span id="sideAvatarFallback">üë§</span>
        <img id="sideAvatarImg" alt="Avatar"/>
      </div>
    </div>

    <div class="menuGroupTitle">Navigation</div>
    <a class="sideItem activeLink" href="user-dashboard.html"><div class="i">üè†</div><div>Dashboard<small>Main overview</small></div></a>
    <a class="sideItem" href="portfolio.html"><div class="i">üìä</div><div>Portfolio<small>Your assets</small></div></a>
    <a class="sideItem" href="deposits.html"><div class="i">üí≥</div><div>Deposit<small>Fund your account</small></div></a>
    <a class="sideItem" href="withdraw.html"><div class="i">‚û°</div><div>Withdraw Funds<small>Request payout</small></div></a>
    <a class="sideItem" href="support.html"><div class="i">üßë‚Äçüíª</div><div>Support / Contact<small>Tickets & help</small></div></a>
    <a class="sideItem" href="plans.html"><div class="i">üíº</div><div>Investment Plans<small>Start investing</small></div></a>
    <a class="sideItem" href="profile.html"><div class="i">üë§</div><div>Profile / Settings<small>Account security</small></div></a>
    <button class="sideLogout" onclick="logout()">Logout</button>
  </div>

  <div class="container">
    <div id="stickyMenu" class="stickyMenu">
      <div class="topRow">
        <div class="brand">
          <!-- ‚úÖ Only wide magnified logo -->
          <img class="brandLogoWide" src="assets/vgm-logo.png" alt="Veloci Global Markets">
        </div>

        <div class="headerActions">
          <button class="avatarBtn" onclick="goProfile()" title="Profile">
            <span id="avatarFallback" class="avatarFallback">üë§</span>
            <img id="avatarImgBtn" class="avatarImgBtn" alt="Avatar"/>
          </button>
          <button class="iconBtn" onclick="openMenu()" title="Menu">‚ò∞</button>
        </div>
      </div>
    </div>

    <div class="helloCard">
      <div class="helloLeft">
        <div class="helloLogo" title="Verified & Secure">üõ°Ô∏è</div>

        <div>
          <div class="chips">
            <div class="miniChip">üü¢ active</div>
            <div class="miniChip" id="countryChip" style="display:none"></div>
          </div>
          <div class="helloTitle" id="greetingTitle">Greetings‚Ä¶</div>
          <div class="helloSub" id="helloName">Loading‚Ä¶</div>
        </div>
      </div>
      <div class="helloRight">
        <div class="helloRightTop">
          <div class="idChip" id="userIdChip">ID:</div>
          <button class="logoutBtn" onclick="logout()" title="Logout">‚éã</button>
        </div>
        <div class="datetimeChip" id="dateTimeNow">--- | ---</div>
      </div>
    </div>

    <div class="balanceCard">
      <div class="bTitle">Total Portfolio Value</div>
      <div class="bValue" id="balance">--</div>
      <div class="bHint"><div class="dot"></div> <div>Your trading account balance</div></div>

      <div class="actionGrid">
        <div class="action" onclick="goWithdrawAndClear()"><div class="aIcon aSend">‚úàÔ∏è</div><div class="aText">Send</div></div>
        <div class="action" onclick="goDepositAndClear()"><div class="aIcon aReceive">‚¨áÔ∏è</div><div class="aText">Receive</div></div>
        <div class="action" onclick="goPlans()"><div class="aIcon aPlans">üìà</div><div class="aText">Plans</div></div>
        <div class="action" onclick="goSupportAndClear()"><div class="aIcon aSupport">üí¨</div><div class="aText">Support</div></div>
      </div>
    </div>

    <div class="box">
      <h2>Active Investment Plan</h2>
      <div id="planMsg" class="small">Loading‚Ä¶</div>
      <div id="planBox"></div>
    </div>

    <div class="box">
      <h2>Top 10 Major Cryptos</h2>
      <div class="small">Live market prices (auto refresh every 20 seconds).</div>
      <div id="top10Msg" class="small">Loading‚Ä¶</div>
      <div id="top10List" class="crypto10Grid"></div>
    </div>

    <div class="box">
      <h2>Crypto Converter</h2>
      <div class="small">Search & convert from ALL coins to ALL fiat currencies.</div>
      <div class="convGrid">
        <div class="convRow">
          <div class="ddWrap" id="ddCryptoA"></div>
          <button class="swapBtn" onclick="swapCrypto()">‚áÑ</button>
          <div class="ddWrap" id="ddCryptoB"></div>
        </div>
        <div class="convRow">
          <input id="cryptoAmount" class="inp" type="number" min="0" step="0.00000001" placeholder="Enter amount"/>
        </div>
        <button class="convBtn" onclick="convertCrypto()">‚ö° Convert</button>
        <div class="card">
          <div class="rateLine"><span class="rateDot"></span> <span id="cryptoRate">Rate: --</span></div>
          <div class="small" style="margin-top:10px;font-size:14px;">Result: <strong id="cryptoResult">--</strong></div>
          <div class="small" style="margin-top:10px;font-size:14px;">Reverse: <strong id="cryptoReverse">--</strong></div>
          <div class="small" style="margin-top:10px;font-size:13px;color:rgba(234,240,255,.55)">
            Tip: Search by coin name or symbol (example: ‚Äúbtc‚Äù, ‚Äúeth‚Äù, ‚Äúsol‚Äù, ‚Äúxrp‚Äù).
          </div>
        </div>
      </div>
    </div>

    <div class="box">
      <h2>Fiat Currency Converter</h2>
      <div class="small">Search & convert from ALL fiat currencies to ALL fiat currencies.</div>
      <div class="convGrid">
        <div class="convRow">
          <div class="ddWrap" id="ddFiatA"></div>
          <button class="swapBtn" onclick="swapFiat()">‚áÑ</button>
          <div class="ddWrap" id="ddFiatB"></div>
        </div>
        <div class="convRow">
          <input id="fiatAmount" class="inp" type="number" min="0" step="0.01" placeholder="Enter amount"/>
        </div>
        <button class="convBtn" onclick="convertFiat()">üí± Convert Fiat</button>
        <div class="card">
          <div class="rateLine"><span class="rateDot"></span> <span id="fiatRate">Rate: --</span></div>
          <div class="small" style="margin-top:10px;font-size:14px;">Result: <strong id="fiatResult">--</strong></div>
        </div>
      </div>
    </div>

    <div class="box">
      <h2>Live Crypto Order Book</h2>
      <div class="small">Auto refresh every 3 seconds. Binance ‚Üí OKX ‚Üí Bybit fallback.</div>

      <div class="convRow" style="margin-top:12px">
        <div class="ddWrap" id="obPairWrap"></div>
        <select id="obPair" style="display:none">
          <option value="BTCUSDT">BTC/USDT</option>
          <option value="ETHUSDT">ETH/USDT</option>
          <option value="BNBUSDT">BNB/USDT</option>
          <option value="XRPUSDT">XRP/USDT</option>
          <option value="SOLUSDT">SOL/USDT</option>
        </select>
      </div>

      <div class="chartWrap">
        <div class="chartHead">
          <span>Mini Candlestick Chart</span>
          <span id="chartPair">BTC/USDT</span>
        </div>
        <iframe id="tvChart" class="chartFrame"></iframe>
      </div>

      <div class="orderBookWrap">
        <div class="obHead">
          <span>Order Book</span>
          <div class="obStatus">
            <span class="pulseDot"></span>
            <span id="obStatusTxt">Connecting‚Ä¶</span>
          </div>
        </div>

        <div class="obGrid">
          <div class="obCol">
            <div class="obColHead"><span>Asks</span><span>Price / Amount / Total</span></div>
            <div id="obAsks" class="obRows"></div>
          </div>

          <div class="obMid">
            <div class="midPrice" id="obMidPrice">--</div>
            <div class="spreadPill" id="obSpread">Spread: --</div>
          </div>

          <div class="obCol">
            <div class="obColHead"><span>Bids</span><span>Price / Amount / Total</span></div>
            <div id="obBids" class="obRows"></div>
          </div>
        </div>

        <div class="obFoot">
          <div id="obExchange">Source: --</div>
          <div id="obUpdated">Updated: --</div>
        </div>
      </div>
    </div>

    <div class="box">
      <h2>Live Crypto News</h2>
      <div class="small">Latest crypto headlines (auto refresh every 60 seconds).</div>
      <div id="newsMsg" class="small">Loading‚Ä¶</div>
      <div id="newsList" class="newsGrid"></div>
    </div>
  </div>

  <!-- DOCK -->
  <div class="dock">
    <div class="dockInner">
      <div class="dockBar">
        <div class="dockItem" onclick="goDepositAndClear()">
          <div id="badgeDepositDock" class="dockBadge">0</div>
          <div class="ico">üí≥</div><div>Deposit</div>
        </div>

        <div class="dockItem" onclick="goWithdrawAndClear()">
          <div id="badgeWithdrawDock" class="dockBadge">0</div>
          <div class="ico">‚û°</div><div>Withdraw</div>
        </div>

        <div class="dockHome" onclick="goDashboard()" title="Home">üè†</div>

        <div class="dockItem" onclick="goPlans()"><div class="ico">üíº</div><div>Plans</div></div>
        <div class="dockItem" onclick="goProfile()"><div class="ico">üë§</div><div>Profile</div></div>
      </div>
    </div>
  </div>

  <script>
    /* ============================================================
      ‚úÖ STICKY MENU POLISH SCRIPT
    ============================================================ */
    (function(){
      const sticky = document.getElementById("stickyMenu");
      if(!sticky) return;
      const onScroll = ()=>{
        if(window.scrollY > 14) sticky.classList.add("isStuck");
        else sticky.classList.remove("isStuck");
      };
      onScroll();
      window.addEventListener("scroll", onScroll, {passive:true});
    })();

    /* ============================================================
      ‚úÖ AUTH GUARD
    ============================================================ */
    const SUPABASE_URL="https://xdcscknfomlzwysczegc.supabase.co";
    const SUPABASE_ANON_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhkY3Nja25mb21send5c2N6ZWdjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc3MTYzMDMsImV4cCI6MjA4MzI5MjMwM30.E6o2wFFMOpK1DghLUqnxG6Ig09djy4bmDQexprhAiB4";
    const EDGE_CLEAR_BADGE_URL = `${SUPABASE_URL}/functions/v1/clear_badge`;
    const supabaseClient=supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    function openMenu(){
      document.getElementById("sidebar").classList.add("open");
      document.getElementById("overlay").classList.add("show");
      document.body.classList.add("menuOpen");
    }
    function closeMenu(){
      document.getElementById("sidebar").classList.remove("open");
      document.getElementById("overlay").classList.remove("show");
      document.body.classList.remove("menuOpen");
    }

    async function logout(){
      await supabaseClient.auth.signOut();
      window.location.replace("login.html");
    }

    function hideGate(){
      const g=document.getElementById("authGate");
      if(g) g.style.display="none";
    }

    (async function authGuard(){
      try{
        const { data: sessionData } = await supabaseClient.auth.getSession();
        const session = sessionData?.session;
        if(!session){ window.location.replace("login.html"); return; }
        hideGate();
      }catch(e){
        window.location.replace("login.html");
      }
    })();
  </script>
</body>
</html>
