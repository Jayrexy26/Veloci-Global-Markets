<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>User Profile - Coinluxora</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
  :root{
    --bg:#050a18;
    --card: rgba(255,255,255,0.06);
    --card2: rgba(0,0,0,0.22);
    --text:#eaf0ff;
    --muted: rgba(234,240,255,.65);
    --stroke: rgba(255,255,255,0.12);

    --blue:#5b6cff;
    --purple:#7c4dff;
    --green:#34d399;

    --ok:#22c55e;
    --err:#f87171;

    --shadow: 0 26px 90px rgba(0,0,0,.55);
    --radius: 18px;
  }

  *{box-sizing:border-box}

  body{
    margin:0;
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    color:var(--text);
    min-height:100vh;
    padding-bottom:90px;
    background: var(--bg);
    overflow-x:hidden;
  }

  /* =========================================================
     ‚úÖ FLOWING GRADIENT BACKGROUND (premium animated)
     ========================================================= */
  .bgFlow{
    position:fixed;
    inset:0;
    z-index:-3;
    background:
      radial-gradient(900px 520px at 10% 10%, rgba(83,113,255,.28), transparent 55%),
      radial-gradient(900px 520px at 90% 20%, rgba(52,211,153,.18), transparent 55%),
      radial-gradient(900px 520px at 40% 90%, rgba(124,77,255,.20), transparent 60%),
      linear-gradient(180deg, rgba(5,10,24,1), rgba(2,6,23,1));
  }
  .blob{
    position:fixed;
    width:520px;
    height:520px;
    border-radius:999px;
    filter: blur(70px);
    opacity:.55;
    z-index:-2;
    mix-blend-mode: screen;
    will-change: transform;
  }
  .blob.b1{ background: rgba(91,108,255,.75); left:-140px; top:-140px; animation: drift1 14s ease-in-out infinite; }
  .blob.b2{ background: rgba(124,77,255,.70); right:-190px; top:10%; animation: drift2 16s ease-in-out infinite; }
  .blob.b3{ background: rgba(52,211,153,.55); left:15%; bottom:-220px; animation: drift3 18s ease-in-out infinite; }

  @keyframes drift1{
    0%   { transform: translate(0,0) scale(1); }
    50%  { transform: translate(220px,120px) scale(1.08); }
    100% { transform: translate(0,0) scale(1); }
  }
  @keyframes drift2{
    0%   { transform: translate(0,0) scale(1); }
    50%  { transform: translate(-240px,160px) scale(1.12); }
    100% { transform: translate(0,0) scale(1); }
  }
  @keyframes drift3{
    0%   { transform: translate(0,0) scale(1); }
    50%  { transform: translate(180px,-170px) scale(1.06); }
    100% { transform: translate(0,0) scale(1); }
  }

  .shimmer{
    position:fixed;
    inset:0;
    z-index:-1;
    opacity:.25;
    background:
      radial-gradient(600px 280px at 30% 10%, rgba(255,255,255,.08), transparent 60%),
      radial-gradient(700px 320px at 80% 60%, rgba(255,255,255,.06), transparent 60%);
    animation: shimmerMove 10s ease-in-out infinite alternate;
    pointer-events:none;
  }
  @keyframes shimmerMove{
    from { transform: translateY(0px); }
    to   { transform: translateY(30px); }
  }

  /* =========================================================
     Top bar (premium glass)
     ========================================================= */
  .topbar{
    position:sticky;
    top:0;
    z-index:20;
    padding:12px 14px;
    background:rgba(2,6,23,0.55);
    backdrop-filter: blur(14px);
    -webkit-backdrop-filter: blur(14px);
    border-bottom:1px solid rgba(255,255,255,0.10);
  }
  .toprow{
    max-width:980px;
    margin:0 auto;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
  }
  .brand{
    display:flex;
    align-items:center;
    gap:10px;
    background:linear-gradient(90deg, rgba(109,87,255,1), rgba(135,116,255,0.86));
    color:#fff;
    border-radius:16px;
    padding:12px 14px;
    font-weight:1000;
    letter-spacing:.6px;
    min-width:140px;
    border:1px solid rgba(255,255,255,.14);
    box-shadow:0 18px 50px rgba(109,87,255,.18);
    cursor:pointer;
    user-select:none;
  }
  .brand svg{width:22px;height:22px}
  .brand span{font-size:18px}

  .topActions{
    display:flex;
    align-items:center;
    gap:12px;
  }
  .circleBtn{
    width:44px;height:44px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,.14);
    background:rgba(0,0,0,.18);
    display:grid;
    place-items:center;
    box-shadow:0 16px 40px rgba(0,0,0,.35);
    cursor:pointer;
    color:rgba(234,240,255,.85);
  }
  .circleBtn:hover{background:rgba(255,255,255,.08)}
  .circleBtn svg{width:22px;height:22px}

  /* =========================================================
     Menu sidebar (for Profile page)
     ========================================================= */
  .overlay{
    position:fixed; inset:0;
    background:rgba(0,0,0,.65);
    display:none; z-index:999;
    backdrop-filter: blur(4px);
  }
  .overlay.show{display:block;}
  .sidebar{
    position:fixed; top:0; left:-290px;
    width:270px; height:100vh;
    background:linear-gradient(180deg, rgba(5,10,24,1), rgba(2,6,23,1));
    border-right:1px solid rgba(255,255,255,.12);
    padding:16px;
    transition:.28s ease;
    z-index:1000;
    box-shadow:0 20px 80px rgba(0,0,0,.6);
  }
  .sidebar.open{ left:0; }

  .brandRow{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
  .brandSide{font-weight:1000;font-size:18px;letter-spacing:.6px;}
  .closeBtn{
    background:rgba(0,0,0,.22);
    border:1px solid rgba(255,255,255,.14);
    color:var(--text);
    border-radius:12px;padding:8px 12px;
    font-weight:1000;
  }
  .userTag{
    padding:12px;border-radius:16px;
    border:1px solid rgba(255,255,255,.12);
    background:rgba(255,255,255,.06);
    margin-bottom:12px;
  }
  .sideItem{
    display:flex;gap:10px;align-items:center;
    padding:12px;
    border:1px solid rgba(255,255,255,.12);
    border-radius:16px;margin-bottom:10px;
    color:var(--text);
    background:rgba(0,0,0,.22);
    font-weight:1000;
    text-decoration:none;
  }
  .sideItem:hover{background:rgba(255,255,255,.08)}
  .activeLink{border:1px solid rgba(56,189,248,.55);background:rgba(56,189,248,0.12);}
  .sideLogout{
    background:linear-gradient(90deg, rgba(248,113,113,1), rgba(239,68,68,1));
    color:#020617;border:none;width:100%;
    padding:14px;border-radius:16px;font-weight:1000;cursor:pointer
  }

  /* =========================================================
     Page content
     ========================================================= */
  .wrap{
    max-width:980px;
    margin:0 auto;
    padding:14px;
  }
  .headRow{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    margin-top:8px;
    margin-bottom:12px;
  }
  .pageTitle{
    font-size:30px;
    font-weight:1000;
    margin:0;
    letter-spacing:-.5px;
  }

  .card{
    border:1px solid rgba(255,255,255,.12);
    background:linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.03));
    border-radius:22px;
    box-shadow:var(--shadow);
    padding:16px;
    overflow:hidden;
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
  }

  /* profile header */
  .profileHead{
    text-align:center;
    padding:14px 0 6px;
  }
  .profileIcon{
    width:110px;height:110px;
    margin:0 auto 10px;
    border-radius:999px;
    background:rgba(0,0,0,.22);
    border:1px solid rgba(255,255,255,.12);
    display:grid;
    place-items:center;
  }
  .profileIcon svg{width:90px;height:90px;opacity:.95}

  .bigName{
    font-size:26px;
    font-weight:1000;
    color:rgba(234,240,255,.75);
    margin:0;
  }
  .bigEmail{
    margin:6px 0 0 0;
    color:rgba(234,240,255,.55);
    font-size:15px;
    font-weight:900;
  }

  .field{margin-top:16px;}
  .label{
    font-size:16px;
    font-weight:1000;
    color:rgba(234,240,255,.65);
    margin:0 0 10px;
  }
  .row{display:flex;gap:10px;align-items:center;}
  .input, select{
    flex:1;
    height:48px;
    border:1px solid rgba(255,255,255,.12);
    border-radius:14px;
    padding:10px 12px;
    font-size:15px;
    outline:none;
    background:rgba(0,0,0,.22);
    color:var(--text);
    box-shadow:0 16px 40px rgba(0,0,0,.35);
  }
  .input::placeholder{color:rgba(234,240,255,.45)}
  .input:disabled, select:disabled{
    background:rgba(0,0,0,.18);
    color:rgba(234,240,255,.75);
    opacity:.9;
  }

  .miniBtn{
    width:48px;height:48px;
    border:none;border-radius:14px;
    background:linear-gradient(180deg, rgba(91,108,255,1), rgba(124,77,255,1));
    color:#fff;
    cursor:pointer;
    display:grid;
    place-items:center;
    box-shadow:0 18px 55px rgba(91,108,255,.22);
    border:1px solid rgba(255,255,255,.12);
  }
  .miniBtn:hover{filter:brightness(1.05)}
  .miniBtn svg{width:22px;height:22px}

  .pwWrap{position:relative; flex:1;}
  .pwWrap .input{padding-right:52px;}
  .eyeBtn{
    position:absolute;
    right:10px;
    top:50%;
    transform:translateY(-50%);
    border:none;
    background:rgba(255,255,255,.08);
    border:1px solid rgba(255,255,255,.12);
    border-radius:12px;
    width:38px;height:38px;
    cursor:pointer;
    display:grid;
    place-items:center;
    color:rgba(234,240,255,.85);
  }
  .eyeBtn:hover{background:rgba(255,255,255,.12)}
  .eyeBtn svg{width:20px;height:20px}

  .note{
    margin-top:8px;
    color:rgba(234,240,255,.55);
    font-size:13px;
    font-weight:900;
  }

  .saveBtn{
    margin-top:18px;
    width:100%;
    height:56px;
    border:none;
    border-radius:16px;
    background:linear-gradient(180deg, rgba(52,211,153,1), rgba(17,185,129,1));
    color:#062015;
    cursor:pointer;
    font-weight:1000;
    font-size:17px;
    display:flex;
    align-items:center;
    justify-content:center;
    gap:10px;
    box-shadow:0 18px 55px rgba(34,197,94,.18);
  }
  .saveBtn:active{transform:translateY(1px)}

  .sectionTitle{
    font-size:24px;
    font-weight:1000;
    color:rgba(234,240,255,.70);
    margin:0 0 10px;
  }
  .blueBtn{
    margin-top:18px;
    width:100%;
    height:58px;
    border:none;
    border-radius:16px;
    background:linear-gradient(180deg, rgba(91,108,255,1), rgba(124,77,255,1));
    color:white;
    cursor:pointer;
    font-weight:1000;
    font-size:17px;
    display:flex;
    align-items:center;
    justify-content:center;
    gap:10px;
    box-shadow:0 18px 55px rgba(91,108,255,.22);
  }
  .blueBtn:active{transform:translateY(1px)}

  .tips{
    margin-top:18px;
    border-top:1px solid rgba(255,255,255,.10);
    padding-top:14px;
  }
  .tipsTitle{
    font-weight:1000;
    color:rgba(234,240,255,.65);
    font-size:16px;
    margin:0 0 10px;
  }
  ul{margin:0;padding-left:18px;color:rgba(234,240,255,.55);line-height:1.7;font-weight:900;font-size:13px}

  .msg{
    margin-top:12px;
    min-height:18px;
    text-align:center;
    font-size:14px;
    color:rgba(234,240,255,.65);
    font-weight:900;
  }
  .ok{color:var(--ok);font-weight:1000}
  .err{color:var(--err);font-weight:1000}

  /* bottom nav - glass */
  .bottomNav{
    position:fixed;
    left:0; right:0; bottom:0;
    z-index:50;
    padding:10px 14px 18px;
    background:rgba(2,6,23,.78);
    border-top:1px solid rgba(255,255,255,.12);
    backdrop-filter: blur(14px);
    -webkit-backdrop-filter: blur(14px);
  }
  .navWrap{
    max-width:980px;
    margin:0 auto;
    display:flex;
    justify-content:space-between;
    align-items:flex-end;
    gap:10px;
    padding:10px 12px;
    border-radius:28px;
    background:rgba(0,0,0,.22);
    border:1px solid rgba(255,255,255,.12);
    box-shadow:0 18px 40px rgba(0,0,0,.30);
  }
  .navItem{
    width:70px;
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:6px;
    color:rgba(234,240,255,.55);
    font-size:12px;
    font-weight:1000;
    text-decoration:none;
  }
  .navItem svg{width:22px;height:22px}
  .home{
    width:74px;height:74px;
    border-radius:22px;
    background:linear-gradient(180deg,#6d5bd0,#5a64d6);
    display:grid;
    place-items:center;
    margin-top:-34px;
    box-shadow:0 18px 38px rgba(88,94,210,.26);
    color:#fff;
    text-decoration:none;
    border:1px solid rgba(255,255,255,.12);
  }
  .home svg{width:30px;height:30px}
  .active{color:#9bdcff}
</style>
</head>

<body>

<!-- flowing background layers -->
<div class="bgFlow"></div>
<div class="blob b1"></div>
<div class="blob b2"></div>
<div class="blob b3"></div>
<div class="shimmer"></div>

<div id="overlay" class="overlay" onclick="closeMenu()"></div>

<!-- SIDEBAR -->
<div id="sidebar" class="sidebar">
  <div class="brandRow">
    <div class="brandSide">COINLUXORA</div>
    <button class="closeBtn" onclick="closeMenu()">‚úï</button>
  </div>

  <div class="userTag">
    <div style="color:rgba(234,240,255,.55);font-weight:1000;font-size:12px;">Logged in as</div>
    <div id="sideEmail" style="font-weight:1000;margin-top:6px;">---</div>
  </div>

  <a class="sideItem" href="user-dashboard.html">üè† Dashboard</a>
  <a class="sideItem" href="deposits.html">üí≥ Deposit</a>
  <a class="sideItem" href="withdraw.html">‚û° Withdraw</a>
  <a class="sideItem" href="plans.html">üíº Plans</a>
  <a class="sideItem" href="support.html">üßë‚Äçüíª Support</a>

  <a class="sideItem activeLink" href="profile.html">üë§ Profile / Settings</a>

  <div style="height:12px"></div>
  <button class="sideLogout" onclick="logout()">Logout</button>
</div>

<!-- TOP BAR -->
<div class="topbar">
  <div class="toprow">
    <!-- ‚úÖ COIN LOGO now opens dashboard -->
    <div class="brand" onclick="goDashboard()">
      <svg viewBox="0 0 24 24" fill="none">
        <path d="M12 2c3.9 0 7 3.1 7 7 0 3.3-2.3 6.1-5.4 6.8l1.5 3.2c.3.6 0 1.4-.7 1.7-.6.3-1.4 0-1.7-.7L11 18.7H8.6c-1 0-1.8-.8-1.8-1.8V16c-1.8-1.3-3-3.4-3-5.9 0-3.9 3.1-7 7-7Z" stroke="white" stroke-width="1.6"/>
      </svg>
      <span>COIN</span>
    </div>

    <div class="topActions">
      <!-- ‚úÖ REMOVED the extra circle button -->
      <!-- ‚úÖ menu button now opens sidebar -->
      <button class="circleBtn" title="Menu" onclick="openMenu()">
        <svg viewBox="0 0 24 24" fill="none">
          <path d="M4 6h16M4 12h16M4 18h16" stroke="currentColor" stroke-width="2.2" stroke-linecap="round"/>
        </svg>
      </button>
    </div>
  </div>
</div>

<div class="wrap">
  <div class="headRow">
    <h2 class="pageTitle">User Profile</h2>
  </div>

  <!-- PROFILE CARD -->
  <div class="card">
    <div class="profileHead">
      <div class="profileIcon" aria-hidden="true">
        <svg viewBox="0 0 120 120" fill="none">
          <path d="M60 22c19 0 34 15 34 34 0 14-8 26-20 31l6 14c3 7-7 12-11 5l-6-12H47c-9 0-16-7-16-16v-4C21 66 16 57 16 46c0-19 15-34 34-34Z" stroke="white" stroke-width="7" stroke-linecap="round" stroke-linejoin="round" opacity=".95"/>
          <path d="M48 60l-8-8c-2-2-6-2-8 0s-2 6 0 8l13 13c2 2 6 2 8 0l30-30c2-2 2-6 0-8s-6-2-8 0L48 60Z" fill="white" opacity=".92"/>
        </svg>
      </div>

      <p class="bigName" id="bigName">Loading...</p>
      <p class="bigEmail" id="bigEmail">Loading...</p>
    </div>

    <div class="field">
      <div class="label">Name:</div>
      <div class="row">
        <input id="name" class="input" type="text" disabled />
        <button class="miniBtn" onclick="toggleEdit('name')" title="Edit Name">
          <svg viewBox="0 0 24 24" fill="none">
            <path d="M4 20h4l10.5-10.5a2 2 0 0 0 0-3L16.5 4a2 2 0 0 0-3 0L3 14.5V20Z" stroke="white" stroke-width="2" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>
    </div>

    <div class="field">
      <div class="label">Email:</div>
      <div class="row">
        <input id="email" class="input" type="email" disabled />
      </div>
    </div>

    <div class="field">
      <div class="label">PIN:</div>
      <div class="row">
        <div class="pwWrap">
          <input id="pin" class="input" type="password" disabled placeholder="****"/>
          <button class="eyeBtn" onclick="toggleEye('pin')" title="Show PIN">
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M2 12s3.6-7 10-7 10 7 10 7-3.6 7-10 7-10-7-10-7Z" stroke="currentColor" stroke-width="2"/>
              <path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z" stroke="currentColor" stroke-width="2"/>
            </svg>
          </button>
        </div>
        <button class="miniBtn" onclick="toggleEdit('pin')" title="Edit PIN">
          <svg viewBox="0 0 24 24" fill="none">
            <path d="M4 20h4l10.5-10.5a2 2 0 0 0 0-3L16.5 4a2 2 0 0 0-3 0L3 14.5V20Z" stroke="white" stroke-width="2" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>
      <div class="note">PIN is required for withdrawals and security approvals.</div>
    </div>

    <div class="field">
      <div class="label">Country:</div>
      <div class="row">
        <select id="country" class="input" disabled>
          <option value="">Select Country</option>
          <option>Nigeria</option><option>United States</option><option>United Kingdom</option><option>Canada</option>
          <option>Germany</option><option>France</option><option>South Africa</option><option>Kenya</option>
          <option>Ghana</option><option>United Arab Emirates</option><option>Saudi Arabia</option><option>India</option>
          <option>Australia</option><option>Brazil</option><option>Mexico</option><option>Japan</option><option>Singapore</option>
          <option>Afghanistan</option><option>Albania</option><option>Algeria</option><option>Andorra</option>
          <option>Angola</option><option>Argentina</option><option>Armenia</option><option>Austria</option>
          <option>Azerbaijan</option><option>Bahamas</option><option>Bahrain</option><option>Bangladesh</option>
          <option>Belgium</option><option>Benin</option><option>Bhutan</option><option>Bolivia</option>
          <option>Bulgaria</option><option>Burkina Faso</option><option>Cambodia</option><option>Cameroon</option>
          <option>Chile</option><option>China</option><option>Colombia</option><option>Costa Rica</option>
          <option>Croatia</option><option>Cuba</option><option>Cyprus</option><option>Denmark</option>
          <option>Egypt</option><option>Estonia</option><option>Ethiopia</option><option>Finland</option>
          <option>Gabon</option><option>Gambia</option><option>Georgia</option><option>Greece</option>
          <option>Hungary</option><option>Iceland</option><option>Indonesia</option><option>Iran</option>
          <option>Iraq</option><option>Ireland</option><option>Israel</option><option>Italy</option>
          <option>Jamaica</option><option>Jordan</option><option>Kazakhstan</option><option>Kuwait</option>
          <option>Lebanon</option><option>Lesotho</option><option>Liberia</option><option>Libya</option>
          <option>Malaysia</option><option>Maldives</option><option>Mali</option><option>Malta</option>
          <option>Mauritius</option><option>Morocco</option><option>Mozambique</option><option>Myanmar</option>
          <option>Nepal</option><option>Netherlands</option><option>New Zealand</option><option>Nicaragua</option>
          <option>Niger</option><option>Norway</option><option>Oman</option><option>Pakistan</option>
          <option>Panama</option><option>Peru</option><option>Philippines</option><option>Poland</option>
          <option>Portugal</option><option>Qatar</option><option>Romania</option><option>Russia</option>
          <option>Rwanda</option><option>Senegal</option><option>Serbia</option><option>Seychelles</option>
          <option>Sierra Leone</option><option>Slovakia</option><option>Slovenia</option><option>Somalia</option>
          <option>South Korea</option><option>South Sudan</option><option>Sri Lanka</option><option>Sudan</option>
          <option>Sweden</option><option>Switzerland</option><option>Syria</option><option>Taiwan</option>
          <option>Tanzania</option><option>Thailand</option><option>Togo</option><option>Tunisia</option>
          <option>Turkey</option><option>Uganda</option><option>Ukraine</option><option>Vietnam</option>
          <option>Yemen</option><option>Zambia</option><option>Zimbabwe</option>
        </select>
        <button class="miniBtn" onclick="toggleEdit('country')" title="Edit Country">
          <svg viewBox="0 0 24 24" fill="none">
            <path d="M4 20h4l10.5-10.5a2 2 0 0 0 0-3L16.5 4a2 2 0 0 0-3 0L3 14.5V20Z" stroke="white" stroke-width="2" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>
    </div>

    <div class="field">
      <div class="label">Phone:</div>
      <div class="row">
        <input id="phone" class="input" type="tel" disabled placeholder=""/>
        <button class="miniBtn" onclick="toggleEdit('phone')" title="Edit Phone">
          <svg viewBox="0 0 24 24" fill="none">
            <path d="M4 20h4l10.5-10.5a2 2 0 0 0 0-3L16.5 4a2 2 0 0 0-3 0L3 14.5V20Z" stroke="white" stroke-width="2" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>
    </div>

    <button class="saveBtn" onclick="saveProfile()">Save Profile Changes</button>
    <div id="msg" class="msg"></div>
  </div>

  <div style="height:18px"></div>

  <!-- CHANGE PASSWORD CARD -->
  <div class="card">
    <div class="sectionTitle">Change Password</div>

    <div class="field">
      <div class="label">New Password:</div>
      <div class="row">
        <div class="pwWrap">
          <input id="newPassword" class="input" type="password" placeholder="">
          <button class="eyeBtn" onclick="toggleEye('newPassword')" title="Show">
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M2 12s3.6-7 10-7 10 7 10 7-3.6 7-10 7-10-7-10-7Z" stroke="currentColor" stroke-width="2"/>
              <path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z" stroke="currentColor" stroke-width="2"/>
            </svg>
          </button>
        </div>
      </div>
      <div class="note">Password must be at least 8 characters long</div>
    </div>

    <div class="field">
      <div class="label">Confirm New Password:</div>
      <div class="row">
        <div class="pwWrap">
          <input id="confirmNewPassword" class="input" type="password" placeholder="">
          <button class="eyeBtn" onclick="toggleEye('confirmNewPassword')" title="Show">
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M2 12s3.6-7 10-7 10 7 10 7-3.6 7-10 7-10-7-10-7Z" stroke="currentColor" stroke-width="2"/>
              <path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z" stroke="currentColor" stroke-width="2"/>
            </svg>
          </button>
        </div>
      </div>
    </div>

    <button class="blueBtn" onclick="changePassword()">Change Password</button>
  </div>

</div>

<!-- bottom nav -->
<div class="bottomNav">
  <div class="navWrap">
    <a class="navItem" href="explore.html">Explore</a>
    <a class="navItem" href="history.html">History</a>
    <a class="home" href="user-dashboard.html" title="Home">üè†</a>
    <a class="navItem active" href="profile.html">Profile</a>
  </div>
</div>

<script>
/* ============================================================
   ‚úÖ COINLUXORA AUTH GUARD (LOGIN + EMAIL VERIFIED REQUIRED)
   Auto-added - protected page
   ============================================================ */
const SUPABASE_URL="https://xdcscknfomlzwysczegc.supabase.co";
const SUPABASE_ANON_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhkY3Nja25mb21send5c2N6ZWdjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc3MTYzMDMsImV4cCI6MjA4MzI5MjMwM30.E6o2wFFMOpK1DghLUqnxG6Ig09djy4bmDQexprhAiB4";
const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

let currentEmail = "";

(async function authGuard(){
  try{
    const { data: sessionData } = await supabaseClient.auth.getSession();
    if(!sessionData?.session){
      window.location.replace("login.html");
      return;
    }

    const { data, error } = await supabaseClient.auth.getUser();
    const user = data?.user;

    if(error || !user){
      window.location.replace("login.html");
      return;
    }

    if(!user.email_confirmed_at){
      await supabaseClient.auth.signOut();
      window.location.replace("verify.html?status=unverified");
      return;
    }

    window.COINLUXORA_USER = user;
    currentEmail = user.email;

    document.getElementById("sideEmail").innerText = currentEmail;

    // Load from user_metadata (works even if users table has no columns)
    loadProfileFromMetadata(user);

  }catch(e){
    window.location.replace("login.html");
  }
})();

/* MENU */
function openMenu(){
  document.getElementById("sidebar").classList.add("open");
  document.getElementById("overlay").classList.add("show");
}
function closeMenu(){
  document.getElementById("sidebar").classList.remove("open");
  document.getElementById("overlay").classList.remove("show");
}

/* NAV */
function goDashboard(){ window.location.href="user-dashboard.html"; }

function toggleEdit(id){
  const el = document.getElementById(id);
  el.disabled = !el.disabled;
  if(!el.disabled) el.focus();
}
function toggleEye(id){
  const el = document.getElementById(id);
  el.type = (el.type === "password") ? "text" : "password";
}
function setMsg(type, text){
  const el = document.getElementById("msg");
  if(type==="ok") el.innerHTML = `<span class="ok">${text}</span>`;
  else if(type==="err") el.innerHTML = `<span class="err">${text}</span>`;
  else el.textContent = text;
}

/* ‚úÖ Load profile from metadata (NO users table column errors) */
function loadProfileFromMetadata(user){
  const md = user.user_metadata || {};

  const full_name = md.full_name || "User";
  const phone = md.phone || "";
  const country = md.country || "";
  const pin = md.pin || "";

  document.getElementById("bigName").textContent = full_name;
  document.getElementById("bigEmail").textContent = user.email;

  document.getElementById("name").value = full_name;
  document.getElementById("email").value = user.email;
  document.getElementById("phone").value = phone;
  document.getElementById("country").value = country;
  document.getElementById("pin").value = pin ? pin : "****";
}

/* ‚úÖ Save profile to user_metadata (stable) */
async function saveProfile(){
  setMsg("", "Saving changes‚Ä¶");

  const user = window.COINLUXORA_USER;
  if(!user){
    setMsg("err","Session missing. Please login again.");
    return;
  }

  const full_name = document.getElementById("name").value.trim();
  const phone     = document.getElementById("phone").value.trim();
  const country   = document.getElementById("country").value.trim();
  const pinVal    = document.getElementById("pin").value.trim();

  if(!full_name){
    setMsg("err","Name cannot be empty.");
    return;
  }

  const { error } = await supabaseClient.auth.updateUser({
    data: {
      full_name,
      phone,
      country,
      pin: (pinVal === "****" ? "" : pinVal)
    }
  });

  if(error){
    setMsg("err", error.message);
    return;
  }

  document.getElementById("bigName").textContent = full_name;

  ["name","phone","country","pin"].forEach(id => document.getElementById(id).disabled = true);

  setMsg("ok","Profile updated successfully ‚úÖ");
}

/* Change password */
async function changePassword(){
  const newPassword = document.getElementById("newPassword").value;
  const confirmNew  = document.getElementById("confirmNewPassword").value;

  if(newPassword.length < 8){
    setMsg("err","New password must be at least 8 characters.");
    return;
  }
  if(newPassword !== confirmNew){
    setMsg("err","New passwords do not match.");
    return;
  }

  const { error } = await supabaseClient.auth.updateUser({ password: newPassword });

  if(error){
    setMsg("err", error.message);
    return;
  }

  document.getElementById("newPassword").value = "";
  document.getElementById("confirmNewPassword").value = "";

  setMsg("ok","Password changed successfully ‚úÖ");
}

async function logout(){
  await supabaseClient.auth.signOut();
  window.location.replace("login.html");
}
</script>

</body>
</html>
